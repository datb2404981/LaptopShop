<div class="container-fluid mt-4 px-4">
  <% if (typeof success !=='undefined' && success) { %>
  <div class="alert alert-danger d-flex align-items-center" role="alert">
    <i class="bi bi-exclamation-triangle-fill me-2" style="font-size: 1rem; line-height: 1;"></i>
    <div>
      Delete User Success!
    </div>
  </div>
  <% } %>
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1>List Users </h1>
    <input type="text" class="form-control w-25" placeholder="Search..." />
  </div>

  <table class="table align-middle table-custom">
    <thead class="table-success">
      <tr>
        <th scope="col" style="width: 10%;">
          <input type="checkbox" />
        </th>
        <th scope="col" style="width: 45%;">Name</th>
        <th scope="col" style="width: 45%;">Address</th>
      </tr>
    </thead>
      <tbody>
        <% usersList.forEach(function(user) { %>
          <tr>
            <td>
              <input type="checkbox" />
            </td>
            <!-- Cột Name -->
            <td>
              <div class="d-flex align-items-center">
                <div class="avatar-circle me-2">
                  <span>
                    <%= user.name.charAt(0).toUpperCase() %>
                  </span>
                </div>
                <div>
                  <div class="fw-semibold">
                    <%= user.name %>
                  </div>
                  <small class="text-muted">
                    <%= user.email %>
                  </small>
                </div>
              </div>
              <!-- Cột Address -->
            <td class="d-flex justify-content-between align-items-center">
              <span class="fw-semibold">
                <%= user.address %>
              </span>
              <div class="dropdown">
                <button class="btn btn-sm btn-light" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="bi bi-three-dots"></i>
                </button>
                <ul class="dropdown-menu">
                  <li>
                  <a href="/editUser/<%= user.id %>" class="dropdown-item">
                    <i class="bi bi-pencil"></i> Edit</a>
                  </li>
                  <li>
                    <form action="/deleteUser/<%= user.id %>" method="post" class="delete-form">
                      <button type="button" class="dropdown-item btn-delete" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal" data-id="<%= user.id %>">
                        <i class="bi bi-trash"></i> Delete
                      </button>
                    </form>
                  </li>
                </ul>
              </div>
            </td>
          </tr>
          <% }); %>
      </tbody>
  </table>
</div>

<!-- Modal Xác Nhận -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="confirmDeleteLabel">Confirm Deletion</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this user?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
      </div>
    </div>
  </div>
</div>

<style>

  .avatar-circle {
  width: 32px;
  height: 32px;
  background-color: rgba(27, 125, 79, 0.15); /* nền xanh lá nhạt */
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: 14px;
  color: #1B7D4F; /* chữ xanh */
  }

.table-success {
  background-color: #28a745  !important; /* xanh lá đậm giống navbar */
  color: white !important; /* chữ trắng nổi bật */
}
.table-custom {
  table-layout: fixed;
  width: 100%;
}

.table-custom thead {
  background-color: #1B7D4F; /* màu navbar */
  color: white; /* chữ trắng để nổi bật */
}

.table-custom tbody tr {
  border-bottom: 1px solid rgba(27, 125, 79, 0.2); /* viền xanh nhạt */
}

.table-custom tbody tr:last-child {
  border-bottom: none;
}

.table-custom tbody tr:hover {
  background-color: rgba(27, 125, 79, 0.05); /* hover xanh nhạt */
}

.table-custom tbody td {
  border: none;
}

/* Modal Header xanh lá */
#confirmDeleteModal .modal-header {
  background-color: #1B7D4F;
  color: white;
  border-bottom: none;
}

/* Nút Xóa */
#confirmDeleteModal .btn-danger {
  background-color: #dc3545;
  border: none;
}
#confirmDeleteModal .btn-danger:hover {
  background-color: #bb2d3b;
}

/* Nút Hủy xanh lá nhạt */
#confirmDeleteModal .btn-secondary {
  background-color: rgba(27, 125, 79, 0.8);
  border: none;
}
#confirmDeleteModal .btn-secondary:hover {
  background-color: rgba(27, 125, 79, 1);
}

/* Bo góc modal + bóng đổ */
#confirmDeleteModal .modal-content {
  border-radius: 10px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

.dropdown-menu {
  min-width: auto;       /* không fix width quá lớn */
  padding: 4px 0;        /* giảm khoảng trống trên/dưới */
}

.dropdown-item {
  padding: 4px 8px;      /* giảm padding mỗi item */
  font-size: 14px;       /* chữ nhỏ hơn */
}

.dropdown-item i {
  margin-right: 6px;     /* khoảng cách icon với text */
  font-size: 14px;       /* icon nhỏ gọn */
}
</style>

<script>
  setTimeout(function () {
    const alertBox = document.querySelector('.alert');
    if (alertBox) {
      alertBox.style.transition = "opacity 0.5s ease";
      alertBox.style.opacity = "0";
      setTimeout(() => alertBox.remove(), 500); // xóa hẳn sau khi mờ
    }
  }, 500); // 1 giây


  let deleteForm;

    document.querySelectorAll('.btn-delete').forEach(button => {
      button.addEventListener('click', function () {
        deleteForm = this.closest('form'); // Lưu form của nút hiện tại
      });
    });

    document.getElementById('confirmDeleteBtn').addEventListener('click', function () {
      if (deleteForm) {
        deleteForm.submit(); // Gửi form khi bấm Xóa
      }
    });
</script>